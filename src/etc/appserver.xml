<?xml version="1.0" encoding="UTF-8"?>
<appserver xmlns="http://www.appserver.io/appserver">

    <initialContext type="TechDivision\ApplicationServer\InitialContext">
        <description><![CDATA[The initial context configuration.]]></description>
        <classLoader type="TechDivision\ApplicationServer\SplClassLoader" />
        <storage type="TechDivision\Storage\StackableStorage" />
    </initialContext>

    <systemLogger type="Monolog\Logger" channelName="system">
        <processors>
            <processor type="Monolog\Processor\IntrospectionProcessor" />
        </processors>
        <handlers>
            <handler type="Monolog\Handler\ErrorLogHandler">
                <formatter type="Monolog\Formatter\LineFormatter">
                    <params>
                        <param name="output" type="string">
                            <![CDATA[[%datetime%] %channel%.%level_name%: %message% %context% %extra%]]></param>
                        <param name="dateFormat" type="string"><![CDATA[Y-m-d H:i:s]]></param>
                    </params>
                </formatter>
                <params>
                    <param name="messageType" type="integer">0</param>
                    <param name="level" type="integer">200</param>
                    <param name="bubble" type="boolean">0</param>
                </params>
            </handler>
        </handlers>
    </systemLogger>

    <containers>

        <container name="persistence"
                   threadType="TechDivision\ApplicationServer\ContainerThread"
                   type="TechDivision\PersistenceContainer\Container">
            <description>
                <![CDATA[This is an example of a container that uses a socket for sending and receiving messages. This solution can be used for clients connecting over a network.]]></description>
            <receiver type="TechDivision\ApplicationServer\Socket\Receiver">
                <worker type="TechDivision\ApplicationServer\Socket\Worker" />
                <thread type="TechDivision\PersistenceContainer\ThreadRequest" />
                <params>
                    <param name="workerNumber" type="integer">16</param>
                    <param name="address" type="string">0.0.0.0</param>
                    <param name="port" type="integer">8585</param>
                </params>
            </receiver>
            <deployment type="TechDivision\PersistenceContainer\Deployment" />
            <host name="localhost" appBase="/webapps" serverAdmin="${appserver.admin.email}"
                  serverSoftware="appserver/${appserver.version} (${os.family}) PHP/${appserver.php.version}" />

        </container>

        <container name="message-queue"
                   threadType="TechDivision\ApplicationServer\ContainerThread"
                   type="TechDivision\MessageQueue\Container">
            <description>
                <![CDATA[This is an example of a message queue that uses a socket to receive messages. This solution can be used for clients connecting over a network.]]></description>
            <receiver type="TechDivision\ApplicationServer\Socket\Receiver">
                <worker type="TechDivision\ApplicationServer\Socket\Worker" />
                <thread type="TechDivision\MessageQueue\ThreadRequest" />
                <params>
                    <param name="workerNumber" type="integer">16</param>
                    <param name="address" type="string">0.0.0.0</param>
                    <param name="port" type="integer">8587</param>
                </params>
            </receiver>
            <deployment type="TechDivision\MessageQueue\Deployment" />
            <host name="localhost" appBase="/webapps" serverAdmin="${appserver.admin.email}"
                  serverSoftware="appserver/${appserver.version} (${os.family}) PHP/${appserver.php.version}" />

        </container>

        <!--
        <container name="http"
            threadType="TechDivision\ApplicationServer\ContainerThread" type="TechDivision\ServletContainer\Container">
            <description><![CDATA[This is an example of a servlet container that uses a socket for sending and receiving HTML requests/responses. This solution can be used for running a web server.]]></description>
            <receiver type="TechDivision\ApplicationServer\Socket\Receiver">
                <worker type="TechDivision\ServletContainer\Socket\Worker" />
                <thread type="TechDivision\ServletContainer\RequestHandler" />
                <params>
                    <param name="workerNumber" type="integer">16</param>
                    <param name="address" type="string">0.0.0.0</param>
                    <param name="port" type="integer">8586</param>
                </params>
            </receiver>
            <deployment type="TechDivision\ServletContainer\Deployment" />
            <host name="localhost" appBase="/webapps" serverAdmin="${appserver.admin.email}"
                serverSoftware="appserver/${appserver.version} (${os.family}) PHP/${appserver.php.version}">
                <vhosts>
                    <vhost name="www.appserver.io" appBase="/site">
                        <aliases>
                            <alias>appserver.io</alias>
                            <alias>appserver.local</alias>
                        </aliases>
                    </vhost>
                    <vhost name="neos.local" appBase="/neos" />
                    <vhost name="neos.appserver.io" appBase="/neos" />
                </vhosts>
            </host>
        </container>

        <container name="http-ssl"
            threadType="TechDivision\ApplicationServer\ContainerThread" type="TechDivision\ServletContainer\Container">
            <description><![CDATA[This is an example of a servlet container that uses a socket for sending and receiving HTML requests/responses. This solution can be used for running a web server.]]></description>
            <receiver type="TechDivision\ApplicationServer\Stream\SecureReceiver">
                <worker type="TechDivision\ServletContainer\Stream\SecureWorker" />
                <thread type="TechDivision\ServletContainer\RequestHandler" />
                <params>
                    <param name="workerNumber" type="integer">16</param>
                    <param name="address" type="string">0.0.0.0</param>
                    <param name="port" type="integer">8588</param>
                    <param name="certPath" type="string">etc/server.pem</param>
                </params>
            </receiver>
            <deployment type="TechDivision\ServletContainer\Deployment" />
            <host name="localhost" appBase="/webapps" serverAdmin="${appserver.admin.email}"
                serverSoftware="appserver/${appserver.version} (${os.family}) PHP/${appserver.php.version}">
                <vhosts>
                    <vhost name="www.appserver.io" appBase="/site">
                        <aliases>
                            <alias>appserver.io</alias>
                            <alias>appserver.local</alias>
                        </aliases>
                    </vhost>
                    <vhost name="neos.local" appBase="/neos" />
                    <vhost name="neos.appserver.io" appBase="/neos" />
                </vhosts>
            </host>
        </container>
        -->

        <container name="web-socket"
                   threadType="TechDivision\ApplicationServer\ContainerThread"
                   type="TechDivision\WebSocketContainer\Container">
            <description>
                <![CDATA[This is an example of a web socket container that handles web socket requests/responses.]]></description>
            <receiver type="TechDivision\WebSocketContainer\RatchetReceiver">
                <worker type="TechDivision\WebSocketContainer\RatchetWorker" />
                <thread type="TechDivision\WebSocketContainer\RatchetRequest" />
                <params>
                    <param name="workerNumber" type="integer">16</param>
                    <param name="address" type="string">0.0.0.0</param>
                    <param name="port" type="integer">8589</param>
                </params>
            </receiver>
            <deployment type="TechDivision\WebSocketContainer\Deployment" />
            <host name="localhost" appBase="/webapps" serverAdmin="${appserver.admin.email}"
                  serverSoftware="appserver/${appserver.version} (${os.family}) PHP/${appserver.php.version}">
                <vhosts>
                    <vhost name="www.appserver.io" appBase="/site">
                        <aliases>
                            <alias>appserver.io</alias>
                            <alias>appserver.local</alias>
                        </aliases>
                    </vhost>
                    <vhost name="neos.local" appBase="/neos" />
                    <vhost name="neos.appserver.io" appBase="/neos" />
                </vhosts>
            </host>
        </container>

		<!--
        <container name="lemcache"
                   threadType="TechDivision\ApplicationServer\ContainerThread"
                   type="TechDivision\LemCacheContainer\Container">
            <description>
                <![CDATA[A memcache API compatible PHP implementation of a key value storage server.]]></description>
            <receiver type="TechDivision\LemCacheContainer\Receiver">
                <worker type="TechDivision\LemCacheContainer\Worker" />
                <thread type="TechDivision\LemCacheContainer\ThreadRequest" />
                <params>
                    <param name="workerNumber" type="integer">8</param>
                    <param name="address" type="string">0.0.0.0</param>
                    <param name="port" type="integer">11210</param>
                </params>
            </receiver>
            <deployment type="TechDivision\LemCacheContainer\Deployment" />
            <host name="localhost" appBase="/webapps" serverAdmin="${appserver.admin.email}"
                  serverSoftware="appserver/${appserver.version} (${os.family}) PHP/${appserver.php.version}">
            </host>
        </container>
		-->
		
        <container
                name="webserver"
                threadType="TechDivision\ApplicationServer\ContainerThread" type="TechDivision\WebContainer\Container">
            <description>
                <![CDATA[This is an example of a webserver container that handles http requests in common way]]></description>
            <deployment type="TechDivision\WebContainer\WebContainerDeployment" />
            <host
                    name="localhost"
                    appBase="/webapps"
                    serverAdmin="${appserver.admin.email}"
                    serverSoftware="appserver/${appserver.version} (${os.family}) PHP/${appserver.php.version}" />
            <servers>
                <server
                        type="\TechDivision\WebServer\Servers\MultiThreadedServer"
                        worker="\TechDivision\WebServer\Workers\ThreadWorker"
                        socket="\TechDivision\WebServer\Sockets\StreamSocket"
                        serverContext="\TechDivision\WebServer\ServerContext">
                    <params>
                        <param name="admin" type="string">admin@appserver.io</param>
                        <param name="software" type="string">appserver/${appserver.version} (${os.family})</param>
                        <param name="transport" type="string">tcp</param>
                        <param name="address" type="string">0.0.0.0</param>
                        <param name="port" type="integer">9080</param>
                        <param name="workerNumber" type="integer">32</param>
                        <param name="documentRoot" type="string">/opt/appserver/webapps</param>
                        <param name="keepAliveMax" type="integer">64</param>
                        <param name="keepAliveTimeout" type="integer">16</param>
                        <param name="errorsPageTemplatePath" type="string">var/www/errors/error.phtml</param>
                    </params>

                    <authentications>
                        <authentication uri="^\/admin.*">
                            <params>
                                <param name="type" type="string">
                                    \TechDivision\WebServer\Authentication\BasicAuthentication
                                </param>
                                <param name="realm" type="string">appserver.io Basic Authentication System</param>
                                <param name="hash" type="string">YXBwc2VydmVyOmFwcHNlcnZlci5pMA==</param>
                                <!-- <param name="file" type="string">var/www/auth/basic/appserver</param> -->
                                <!-- <param name="username" type="string">appserver</param> -->
                                <!-- <param name="password" type="string">wURpZpgIT.w1I</param> -->
                            </params>
                        </authentication>
                    </authentications>

                    <virtualHosts>
                        <virtualHost name="magento.dev magento.local">
                            <params>
                                <param name="admin" type="string">admin@appserver.io</param>
                                <param name="documentRoot" type="string">/opt/appserver/webapps/magento-1.8.1.0</param>
                            </params>
                            <rewrites>
                                <rewrite condition="-d|-f|-l" target="" flag="L" />
                                <rewrite condition="(.*),!^/index\.php" target="/index.php/$1" flag="L" />
                            </rewrites>
                        </virtualHost>
                        <virtualHost name="example.local">
                            <params>
                                <param name="admin" type="string">admin@appserver.io</param>
                                <param name="documentRoot" type="string">/opt/appserver/webapps/example</param>
                            </params>
                            <rewrites>
                                <rewrite condition="-d|-f|-l" target="" flag="L" />
                                <rewrite condition="(.+)([/\?].+),!\.do" target="/$1.do$2" flag="L" />
                                <rewrite condition="(.+),!\.do" target="/$1.do" flag="L" />
                            </rewrites>
                        </virtualHost>
                        <virtualHost name="appserver.io www.appserver.io appserver.local site.local">
                            <params>
                                <param name="admin" type="string">admin@appserver.io</param>
                                <param name="documentRoot" type="string">/opt/appserver/webapps/site</param>
                            </params>
                            <rewrites>
                                <rewrite condition="-d|-f|-l,!^/$" target="" flag="L" />
                                <rewrite condition="^/index([/\?]*.*)" target="/index.do$1" flag="L" />
                                <rewrite condition="downloads([/\?]*.*)" target="/downloads.do/downloads$1" flag="L" />
                                <rewrite condition="documentation([/\?]*.*)" target="/index.do/documentation$1" flag="L" />
                                <rewrite condition="^/dl([/\?]*.*)" target="/dl.do$1" flag="L" />
                                <rewrite condition="^(/\?*.*)" target="/index.do$1" flag="L" />
                            </rewrites>
                        </virtualHost>
                    </virtualHosts>

                    <connectionHandlers>
                        <connectionHandler type="\TechDivision\Http\HttpConnectionHandler" />
                    </connectionHandlers>
                    <modules>
                        <module type="\TechDivision\WebServer\Modules\AuthenticationModule" />
                        <module type="\TechDivision\WebServer\Modules\VirtualHostModule" />
                        <module type="\TechDivision\RewriteModule\RewriteModule" />
                        <module type="\TechDivision\WebServer\Modules\DirectoryModule" />
                        <module type="\TechDivision\WebServer\Modules\CoreModule" />
                        <!--
                        <module type="\TechDivision\WebServer\Modules\DeflateModule" />
                        -->
                        <module type="\TechDivision\WebServer\Modules\PhpModule" />
                        <module type="\TechDivision\ServletModule\ServletModule" />
                    </modules>
                    <fileHandlers>
                        <fileHandler name="php" extension=".php" />
                        <fileHandler name="php" extension=".phtml" />
                        <fileHandler name="servlet" extension=".do" />
                    </fileHandlers>
                </server>
                <server
                        type="\TechDivision\WebServer\Servers\MultiThreadedServer"
                        worker="\TechDivision\WebServer\Workers\ThreadWorker"
                        socket="\TechDivision\WebServer\Sockets\StreamSocket"
                        serverContext="\TechDivision\WebServer\ServerContext">
                    <params>
                        <param name="admin" type="string">admin@appserver.io</param>
                        <param name="software" type="string">appserver/${appserver.version} (${os.family})</param>
                        <param name="workerNumber" type="integer">32</param>
                        <param name="transport" type="string">ssl</param>
                        <param name="address" type="string">0.0.0.0</param>
                        <param name="port" type="integer">9443</param>
                        <param name="certPath" type="string">etc/server.pem</param>
                        <param name="passphrase" type="string"></param>
                        <param name="documentRoot" type="string">/opt/appserver/webapps</param>
                        <param name="keepAliveMax" type="integer">64</param>
                        <param name="keepAliveTimeout" type="integer">16</param>
                        <param name="errorsPageTemplatePath" type="string">var/www/errors/error.phtml</param>
                    </params>

                    <authentications>
                        <authentication uri="^\/admin.*">
                            <params>
                                <param name="type" type="string">
                                    \TechDivision\WebServer\Authentication\BasicAuthentication
                                </param>
                                <param name="realm" type="string">appserver.io Basic Authentication System</param>
                                <param name="hash" type="string">YXBwc2VydmVyOmFwcHNlcnZlci5pMA==</param>
                                <!-- <param name="file" type="string">var/www/auth/basic/appserver</param> -->
                                <!-- <param name="username" type="string">appserver</param> -->
                                <!-- <param name="password" type="string">wURpZpgIT.w1I</param> -->
                            </params>
                        </authentication>
                    </authentications>

                    <virtualHosts>
                        <virtualHost name="magento.dev magento.local">
                            <params>
                                <param name="admin" type="string">admin@appserver.io</param>
                                <param name="documentRoot" type="string">/opt/appserver/webapps/magento-1.8.1.0</param>
                            </params>
                            <rewrites>
                                <rewrite condition="-d|-f|-l" target="" flag="L" />
                                <rewrite condition="(.*),!^/index\.php" target="/index.php/$1" flag="L" />
                            </rewrites>
                        </virtualHost>
                        <virtualHost name="example.local">
                            <params>
                                <param name="admin" type="string">admin@appserver.io</param>
                                <param name="documentRoot" type="string">/opt/appserver/webapps/example</param>
                            </params>
                            <rewrites>
                                <rewrite condition="-d|-f|-l" target="" flag="L" />
                                <rewrite condition="(.+)([/\?].+),!\.do" target="/$1.do$2" flag="L" />
                                <rewrite condition="(.+),!\.do" target="/$1.do" flag="L" />
                            </rewrites>
                        </virtualHost>
                        <virtualHost name="appserver.io www.appserver.io appserver.local site.local">
                            <params>
                                <param name="admin" type="string">admin@appserver.io</param>
                                <param name="documentRoot" type="string">/opt/appserver/webapps/site</param>
                            </params>
                            <rewrites>
                                <rewrite condition="-d|-f|-l,!^/$" target="" flag="L" />
                                <rewrite condition="^/index([/\?]*.*)" target="/index.do$1" flag="L" />
                                <rewrite condition="downloads([/\?]*.*)" target="/downloads.do/downloads$1" flag="L" />
                                <rewrite condition="documentation([/\?]*.*)" target="/index.do/documentation$1" flag="L" />
                                <rewrite condition="^/dl([/\?]*.*)" target="/dl.do$1" flag="L" />
                                <rewrite condition="^(/\?*.*)" target="/index.do$1" flag="L" />
                            </rewrites>
                        </virtualHost>
                    </virtualHosts>

                    <connectionHandlers>
                        <connectionHandler type="\TechDivision\Http\HttpConnectionHandler" />
                    </connectionHandlers>
                    <modules>
                        <module type="\TechDivision\WebServer\Modules\AuthenticationModule" />
                        <module type="\TechDivision\WebServer\Modules\VirtualHostModule" />
                        <module type="\TechDivision\RewriteModule\RewriteModule" />
                        <module type="\TechDivision\WebServer\Modules\DirectoryModule" />
                        <module type="\TechDivision\WebServer\Modules\CoreModule" />
                        <!--
                        <module type="\TechDivision\WebServer\Modules\DeflateModule" />
                        -->
                        <module type="\TechDivision\WebServer\Modules\PhpModule" />
                        <module type="\TechDivision\ServletModule\ServletModule" />
                    </modules>
                    <fileHandlers>
                        <fileHandler name="php" extension=".php" />
                        <fileHandler name="php" extension=".phtml" />
                        <fileHandler name="servlet" extension=".do" />
                    </fileHandlers>
                </server>
            </servers>
        </container>
        
        <container
                name="lemcache"
                threadType="TechDivision\ApplicationServer\ContainerThread" type="TechDivision\LemCacheContainer\CacheContainer">
            <description>
                <![CDATA[A memcache API compatible PHP implementation of a key value storage server.]]>
            </description>
            
            <deployment type="TechDivision\LemCacheContainer\Deployment" />
            
            <servers>  		
                
                <server
                        type="\TechDivision\LemCacheContainer\Servers\MultiThreadedServer"
                        worker="\TechDivision\WebServer\Workers\ThreadWorker"
                        socket="\TechDivision\WebServer\Sockets\StreamSocket"
                        serverContext="\TechDivision\WebServer\ServerContext">
                    <params>
                        <param name="admin" type="string">admin@appserver.io</param>
                        <param name="software" type="string">appserver/0.6.0beta1 (mac)</param>
                        <param name="transport" type="string">tcp</param>
                        <param name="address" type="string">0.0.0.0</param>
                        <param name="port" type="integer">11210</param>
                        <param name="workerNumber" type="integer">8</param>
                        <param name="keepAliveMax" type="integer">64</param>
                        <param name="keepAliveTimeout" type="integer">16</param>
                    </params>

                    <connectionHandlers>
                        <connectionHandler type="\TechDivision\MemcacheProtocol\MemcacheConnectionHandler" />
                    </connectionHandlers>
                    
                </server>
            </servers>
        </container>

    </containers>

</appserver>
